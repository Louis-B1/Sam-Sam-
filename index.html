<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mission Samuel √† Paris ‚Äî Neo Edition (Remastered)</title>
    <style>
        /* ===========================
           üé® DESIGN SYSTEM NEO-PARIS
           =========================== */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap');

        :root {
            --neo-cyan: #00F5FF;
            --neo-magenta: #FF006E;
            --neo-yellow: #FFBE0B;
            --neo-purple: #8B5CF6;
            --dark-1: #0A0E27;
            --dark-2: #1A1F3A;
            --dark-3: #2E3856;
            --success: #39FF14;
            --danger: #FF003C;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body { 
            background: linear-gradient(135deg, #000000 0%, #0d1b2a 50%, #1b263b 100%);
            margin: 0; overflow: hidden; 
            font-family: 'Rajdhani', 'Courier New', monospace; 
            color: white; 
            display: flex; justify-content: center; align-items: center; 
            height: 100vh;
            user-select: none;
            position: relative;
        }

        /* --- SCANLINES + VIGNETTE --- */
        .scanlines {
            position: fixed; left: 0; top: 0; width: 100%; height: 100%; 
            pointer-events: none; z-index: 999;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15),
                rgba(0, 0, 0, 0.15) 1px,
                transparent 1px,
                transparent 2px
            );
            animation: scanline-anim 8s linear infinite;
        }

        @keyframes scanline-anim {
            0% { transform: translateY(0); }
            100% { transform: translateY(10px); }
        }

        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(ellipse at center, transparent 0%, rgba(0,0,0,0.7) 100%);
            pointer-events: none;
            z-index: 998;
        }

        /* --- ANIMATED BACKGROUND --- */
        @keyframes bg-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        body {
            background: linear-gradient(270deg, #0A0E27, #1A1F3A, #2E3856, #1A1F3A);
            background-size: 400% 400%;
            animation: bg-shift 20s ease infinite;
        }

        /* ===========================
           üì∫ TITLE SCREEN
           =========================== */
        #title-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(ellipse at center, #000 0%, #000428 100%);
            z-index: 300; 
            display: flex; flex-direction: column; 
            justify-content: center; align-items: center;
            animation: fadeOut 1.5s ease-in-out 3s forwards;
        }

        #title-main { 
            font-family: 'Orbitron', monospace;
            font-size: 120px; 
            font-weight: 900; 
            background: linear-gradient(45deg, var(--neo-cyan), var(--neo-magenta), var(--neo-yellow));
            background-size: 200% 200%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 
                0 0 20px rgba(0, 245, 255, 0.8),
                0 0 40px rgba(255, 0, 110, 0.6);
            animation: title-glow 3s ease-in-out infinite, title-shift 8s ease infinite;
            letter-spacing: 8px;
        }

        @keyframes title-glow {
            0%, 100% { filter: brightness(1) drop-shadow(0 0 20px var(--neo-cyan)); }
            50% { filter: brightness(1.5) drop-shadow(0 0 40px var(--neo-magenta)); }
        }

        @keyframes title-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        #title-subtitle {
            font-size: 48px; 
            color: var(--neo-magenta); 
            letter-spacing: 12px; 
            margin-top: 20px;
            text-shadow: 0 0 30px var(--neo-magenta);
            animation: pulse-subtitle 2s ease-in-out infinite;
            font-weight: 700;
        }

        @keyframes pulse-subtitle {
            0%, 100% { opacity: 0.8; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.05); }
        }

        @keyframes fadeOut { 
            to { opacity: 0; visibility: hidden; } 
        }

        /* ===========================
           üì± PHONE INTERFACE
           =========================== */
        #phone-container {
            position: absolute; 
            width: 380px; 
            height: 760px;
            background: linear-gradient(135deg, var(--dark-2), var(--dark-3));
            border: 8px solid var(--dark-1);
            border-radius: 50px;
            display: flex; 
            flex-direction: column; 
            overflow: hidden;
            z-index: 200; 
            box-shadow: 
                0 0 60px rgba(0, 245, 255, 0.6),
                0 0 100px rgba(255, 0, 110, 0.4),
                inset 0 0 80px rgba(0, 0, 0, 0.8);
            opacity: 0; 
            transform: scale(0.8) rotateX(10deg);
            animation: phone-appear 1.2s cubic-bezier(0.68, -0.55, 0.265, 1.55) 3.5s forwards;
        }

        @keyframes phone-appear { 
            to { opacity: 1; transform: scale(1) rotateX(0deg); } 
        }

        /* Phone notch */
        #phone-container::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 25px;
            background: #000;
            border-radius: 0 0 20px 20px;
            z-index: 10;
        }

        #chat-header { 
            background: linear-gradient(135deg, var(--dark-2), var(--dark-3));
            padding: 35px 20px 20px 20px; 
            text-align: center; 
            border-bottom: 2px solid var(--neo-cyan);
            font-weight: 700;
            font-size: 18px;
            letter-spacing: 2px;
            text-shadow: 0 0 10px var(--neo-cyan);
            position: relative;
        }

        #chat-header::after {
            content: '‚óè';
            position: absolute;
            top: 40px;
            right: 20px;
            color: var(--success);
            font-size: 14px;
            animation: blink 1.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        #chat-body { 
            flex: 1; 
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            gap: 14px; 
            background: var(--dark-1);
            overflow-y: auto; 
        }

        #chat-body::-webkit-scrollbar { width: 6px; }
        #chat-body::-webkit-scrollbar-track { background: var(--dark-2); }
        #chat-body::-webkit-scrollbar-thumb { 
            background: var(--neo-cyan); 
            border-radius: 10px; 
        }

        .msg { 
            max-width: 75%; 
            padding: 14px 18px; 
            border-radius: 20px; 
            font-size: 14px; 
            line-height: 1.5;
            animation: slideUp 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
        }

        @keyframes slideUp { 
            from { transform: translateY(20px) scale(0.9); opacity: 0; } 
            to { transform: translateY(0) scale(1); opacity: 1; } 
        }

        .left { 
            background: linear-gradient(135deg, var(--dark-3), var(--dark-2));
            align-self: flex-start;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-left: 3px solid var(--neo-cyan);
        }

        .right { 
            background: linear-gradient(135deg, var(--neo-cyan), var(--neo-purple));
            align-self: flex-end;
            color: #fff;
            font-weight: 600;
            border-right: 3px solid var(--neo-yellow);
        }

        .sender { 
            font-size: 10px; 
            color: var(--neo-yellow);
            margin-bottom: 6px; 
            display: block; 
            font-weight: 700; 
            text-transform: uppercase; 
            letter-spacing: 1px;
        }

        #btn-start { 
            padding: 28px; 
            background: linear-gradient(135deg, var(--success), #2ecc71);
            text-align: center; 
            cursor: pointer; 
            font-weight: 900; 
            font-size: 20px; 
            display: none; 
            border-top: 3px solid var(--neo-yellow);
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        #btn-start::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        #btn-start:hover::before {
            width: 400px;
            height: 400px;
        }

        #btn-start:hover {
            transform: scale(1.05);
            box-shadow: 0 0 30px var(--success);
        }

        /* ===========================
           üéÆ GAME CONTAINER
           =========================== */
        #game-container { 
            position: relative; 
            display: none;
            animation: game-enter 0.8s ease-out;
        }

        @keyframes game-enter {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        canvas { 
            background: #000;
            border: 6px solid var(--dark-3);
            border-radius: 20px;
            box-shadow: 
                0 0 60px rgba(0, 245, 255, 0.5),
                0 0 100px rgba(255, 0, 110, 0.3),
                inset 0 0 100px rgba(0, 0, 0, 0.8);
            image-rendering: pixelated;
            
            /* --- NOUVEAU : POST PROCESSING --- */
            filter: contrast(1.1) brightness(1.1) sepia(0.2);
        }

        /* --- HUD --- */
        #game-ui {
            position: absolute; 
            top: 20px; 
            left: 20px;
            background: rgba(10, 14, 39, 0.9);
            backdrop-filter: blur(10px);
            padding: 20px 25px;
            border-radius: 20px;
            border: 2px solid var(--neo-cyan);
            min-width: 280px;
            z-index: 10;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
            animation: hud-slide-in 0.6s ease-out;
        }

        @keyframes hud-slide-in {
            from { transform: translateX(-100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .ui-level { 
            color: var(--neo-yellow);
            font-weight: 900;
            font-size: 16px;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
            text-shadow: 0 0 10px var(--neo-yellow);
            animation: level-pulse 2s ease-in-out infinite;
        }

        @keyframes level-pulse {
            0%, 100% { text-shadow: 0 0 10px var(--neo-yellow); }
            50% { text-shadow: 0 0 20px var(--neo-yellow), 0 0 30px var(--neo-yellow); }
        }

        .ui-score { 
            font-size: 22px;
            font-weight: 700;
            color: #fff;
        }

        .ui-score span {
            color: var(--success);
            font-weight: 900;
            font-size: 26px;
            text-shadow: 0 0 10px var(--success);
            transition: all 0.3s ease;
        }

        .ui-score span.score-update {
            animation: score-pop 0.5s ease;
        }

        @keyframes score-pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.5); color: var(--neo-yellow); }
            100% { transform: scale(1); }
        }

        #msg-popup { 
            margin-top: 15px;
            padding: 10px;
            background: rgba(255, 0, 60, 0.2);
            border-left: 3px solid var(--danger);
            border-radius: 8px;
            color: var(--danger);
            font-weight: 700;
            min-height: 20px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            animation: msg-flash 0.5s ease;
        }

        @keyframes msg-flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; background: rgba(255, 0, 60, 0.4); }
        }

        /* ===========================
           üí¨ POPUPS
           =========================== */
        #main-popup {
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(10, 14, 39, 0.98), rgba(46, 56, 86, 0.98));
            backdrop-filter: blur(10px);
            color: #fff;
            padding: 35px;
            border: 4px solid var(--neo-yellow);
            z-index: 100;
            display: none;
            text-align: center;
            box-shadow: 
                0 0 50px var(--neo-yellow),
                inset 0 0 60px rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            min-width: 350px;
            animation: popup-enter 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes popup-enter {
            from { transform: translate(-50%, -50%) scale(0.5) rotate(-10deg); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
        }

        #main-popup h3 { 
            margin-top: 0;
            margin-bottom: 20px;
            color: var(--neo-yellow);
            font-size: 28px;
            text-transform: uppercase;
            letter-spacing: 3px;
            text-shadow: 0 0 20px var(--neo-yellow);
            font-weight: 900;
        }

        #main-popup p { 
            font-size: 18px;
            line-height: 1.6;
            color: #e0e0e0;
            font-weight: 500;
        }

        #letter-popup {
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%) rotate(-2deg);
            background: linear-gradient(135deg, #fff 0%, #f5f5f5 100%);
            color: #000;
            padding: 40px;
            border: 6px double var(--danger);
            z-index: 101;
            display: none;
            text-align: center;
            box-shadow: 
                0 0 60px var(--danger),
                0 20px 60px rgba(0, 0, 0, 0.8);
            border-radius: 8px;
            font-family: 'Courier New', serif;
            min-width: 380px;
            animation: letter-enter 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes letter-enter {
            from { transform: translate(-50%, -50%) rotate(90deg) scale(0); opacity: 0; }
            to { transform: translate(-50%, -50%) rotate(-2deg) scale(1); opacity: 1; }
        }

        #letter-popup h3 { 
            margin-top: 0;
            margin-bottom: 25px;
            color: var(--danger);
            font-size: 26px;
            text-decoration: underline;
            font-weight: 900;
        }

        #letter-popup p { 
            font-size: 19px;
            font-weight: 600;
            font-style: italic;
            line-height: 1.8;
        }

        /* ===========================
           üèÜ END SCREEN
           =========================== */
        #end-screen {
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background: radial-gradient(ellipse at center, rgba(10,14,39,0.98) 0%, rgba(0,0,0,0.99) 100%);
            backdrop-filter: blur(5px);
            z-index: 400;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            animation: end-enter 1s ease-out;
        }

        @keyframes end-enter {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        #end-screen h1 {
            color: var(--success);
            font-size: 64px;
            font-weight: 900;
            text-shadow: 
                0 0 20px var(--success),
                0 0 40px var(--success),
                0 0 60px var(--success);
            margin-bottom: 30px;
            letter-spacing: 4px;
            animation: end-title-glow 2s ease-in-out infinite;
        }

        @keyframes end-title-glow {
            0%, 100% { text-shadow: 0 0 20px var(--success); }
            50% { text-shadow: 0 0 40px var(--success), 0 0 80px var(--success); }
        }

        #samuel-img { 
            width: 280px;
            height: 280px;
            object-fit: cover;
            border: 6px solid var(--success);
            border-radius: 50%;
            margin: 30px;
            background: var(--dark-2);
            box-shadow: 
                0 0 40px var(--success),
                inset 0 0 60px rgba(0, 0, 0, 0.5);
            animation: pulseSam 3s ease-in-out infinite;
        }

        @keyframes pulseSam { 
            0%, 100% { 
                transform: scale(1); 
                box-shadow: 0 0 40px var(--success); 
            } 
            50% { 
                transform: scale(1.08); 
                box-shadow: 0 0 80px var(--success), 0 0 120px rgba(57, 255, 20, 0.5); 
            } 
        }

        .end-text-box { 
            background: linear-gradient(135deg, var(--dark-2), var(--dark-3));
            backdrop-filter: blur(10px);
            padding: 30px 40px;
            border-radius: 20px;
            border: 2px solid var(--neo-cyan);
            max-width: 650px;
            font-size: 20px;
            line-height: 1.8;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
            animation: slideUpBox 0.8s ease-out 0.5s backwards;
        }

        @keyframes slideUpBox { 
            from { opacity: 0; transform: translateY(50px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        button.replay-btn {
            padding: 18px 45px;
            font-size: 20px;
            font-weight: 900;
            cursor: pointer;
            background: linear-gradient(135deg, var(--danger), #e74c3c);
            color: white;
            border: none;
            border-radius: 50px;
            text-transform: uppercase;
            letter-spacing: 2px;
            box-shadow: 0 6px 30px rgba(255, 0, 60, 0.6);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        button.replay-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        button.replay-btn:hover::before {
            width: 300px;
            height: 300px;
        }

        button.replay-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 40px rgba(255, 0, 60, 0.8);
        }

        /* ===========================
           üì± RESPONSIVE
           =========================== */
        @media (max-width: 850px) {
            #title-main { font-size: 60px; }
            #title-subtitle { font-size: 24px; }
            #phone-container { width: 90vw; height: 90vh; }
            canvas { width: 95vw !important; height: 95vw !important; }
        }

    </style>
</head>
<body>

    <div class="scanlines"></div>
    <div id="youtube-audio" style="position:absolute; top:-9999px;"></div>

    <div id="title-screen">
        <div id="title-main">PARIS</div>
        <div id="title-subtitle">BY NIGHT</div>
    </div>

    <div id="phone-container">
        <div id="chat-header">Les Chipies (4)</div>
        <div id="chat-body"></div>
        <div id="btn-start">üöÄ SAUVER LE SOLDAT SAMUEL</div>
    </div>

    <div id="game-container">
        <div id="game-ui">
            <div class="ui-level" id="level-name">NIVEAU 1</div>
            <div class="ui-score">Indices : <span id="score">0</span> / 3</div>
            <div id="msg-popup"></div>
        </div>
        <div id="main-popup"></div>
        <div id="letter-popup">
            <h3>üíå Lettre d'Alexis üíå</h3>
            <p>Mon Sam ch√©ri, rejoins-moi vite.<br>Le Kebab refroidit... Je t'attends. ‚ù§Ô∏è</p>
        </div>
        <canvas id="gameCanvas" width="800" height="800"></canvas>
    </div>

    <div id="end-screen">
        <h1>‚ú® SAMUEL RETROUV√â ! ‚ú®</h1>
        <img id="samuel-img" src="samuel.jpg" alt="Samuel" onerror="this.style.display='none';">
        <div class="end-text-box"> 
            Wesh l'√©quipe... J'avais plus de batterie.<br>
            Je dormais sur un banc.<br>
            C'√©tait pas la police, juste des pigeons qui m'attaquaient.<br>
            <b>Paris be like !</b>
        </div>
        <button class="replay-btn" onclick="location.reload()">üîÑ REJOUER</button>
    </div>

    <script>
        const TILE = 40; 
        const GRID_SIZE = 20;
        
        // --- NOUVEAU : VARIABLES VISUELLES (Game Feel) ---
        let renderPlayer = { x: 0, y: 0 }; // Position visuelle liss√©e
        let screenShake = 0;               // Intensit√© du tremblement
        let particles = [];                // Tableau de particules
        const LERP_SPEED = 0.2;            // Vitesse de lissage (0.1 = lent, 0.5 = rapide)

        // --- AUDIO ---
        var player;
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('youtube-audio', {
                height: '0', width: '0', videoId: 'Vol9dZ-t93s',
                playerVars: { 'autoplay': 0, 'controls': 0, 'loop': 1, 'playlist': 'Vol9dZ-t93s' }
            });
        }

        // --- DATA ---
        const chatMessages = [
            { s: 'Mathis', t: "Il est pass√© o√π Samuel ?" },
            { s: 'Samuel', t: "Oh les gars ! C'est Chaud l√† !" },
            { s: 'Samuel', t: "La police me coursent !!" },
            { s: 'In√®ss', t: "Mdr arr√™te Sam, t'as encore bu avoue üòÇ" },
            { s: 'Samuel', t: "Non ! J'√©tais Place des Vosges, puis j'ai fui vers Pigalle." },
            { s: 'Lily', t: "Encore..." },
            { s: 'Samuel', t: "J'ai paum√© mes affaires. Attention aux pigeons, ils sont violents." },
            { s: 'Moi', t: "Ok j'arrive. üí™" }
        ];

        let currentLevel = 1;
        let map = [];
        let items = [];
        let enemies = [];
        let playerPos = {x: 0, y: 0};
        let score = 0;
        let gameActive = false;
        let animTimer = 0;

        // CONFIG NIVEAUX
        const levels = {
            1: {
                name: "üå≥ PLACE DES VOSGES",
                colorWall: '#a52a2a', 
                colorGround: '#27ae60', 
                colorPath: '#ecf0f1',
                items: [
                    {x: 4, y: 4, type: 'card', name: 'üí≥ Carte Bancaire'},
                    {x: 15, y: 4, type: 'kebab', name: 'ü•ô Kebab Sauce Blanche'},
                    {x: 4, y: 15, type: 'cap', name: 'üß¢ Casquette Mbapp√©'}
                ],
                enemies: [{x: 8, y: 8, dx: 1}, {x: 12, y: 12, dx: -1}], 
                start: {x: 10, y: 18}, 
                exit: {x: 10, y: 0}, 
                exitName: "M√âTRO"
            },
            2: {
                name: "üåÉ PIGALLE (LA NUIT)",
                colorWall: '#2c2c2c', 
                colorGround: '#1a1a1a', 
                colorPath: '#333',
                items: [
                    {x: 3, y: 3, type: 'letter', name: "üíå Lettre d'amour d'Alexis"},
                    {x: 16, y: 3, type: 'key', name: "üîë Cl√© d'Ang√®le"},
                    {x: 16, y: 16, type: 'foodbag', name: "üõçÔ∏è Sac de nourriture"}
                ],
                enemies: [
                    {x: 5, y: 5, dx: 1}, 
                    {x: 15, y: 15, dx: -1}, 
                    {x: 5, y: 15, dx: 1}, 
                    {x: 10, y: 10, dx: 1}
                ],
                start: {x: 10, y: 18}, 
                exit: {x: 10, y: 9}, 
                exitName: "SAMUEL"
            }
        };

        const ctx = document.getElementById('gameCanvas').getContext('2d');
        ctx.imageSmoothingEnabled = false;

        // --- NOUVEAU : SYST√àME DE PARTICULES ---
        class Particle {
            constructor(x, y, type) {
                this.x = x;
                this.y = y;
                this.life = 1.0;
                this.type = type;
                
                if(type === 'score') {
                    this.vx = (Math.random() - 0.5) * 2;
                    this.vy = -2 - Math.random();
                    this.color = '#ffff00';
                    this.size = 5;
                } else if (type === 'rain') {
                    this.vx = -1;
                    this.vy = 8 + Math.random() * 4;
                    this.color = 'rgba(174, 194, 224, 0.5)';
                    this.size = 2;
                    this.life = 2.0; 
                } else if (type === 'pollen') {
                    this.vx = (Math.random() - 0.5) * 0.5;
                    this.vy = (Math.random() - 0.5) * 0.5;
                    this.color = 'rgba(255, 215, 0, 0.4)';
                    this.size = 2;
                }
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                
                if (this.type === 'score') {
                    this.life -= 0.02;
                } else if (this.type === 'rain') {
                    if (this.y > 800) {
                        this.y = -10;
                        this.x = Math.random() * 800;
                    }
                } else {
                    this.life -= 0.01;
                }
            }

            draw(ctx) {
                ctx.save();
                ctx.globalAlpha = this.life;
                ctx.fillStyle = this.color;
                
                if (this.type === 'rain') {
                    ctx.fillRect(this.x, this.y, 1, 10);
                } else {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fill();
                }
                ctx.restore();
            }
        }

        function spawnParticles(type, x, y, amount = 1) {
            for(let i=0; i<amount; i++) {
                particles.push(new Particle(x, y, type));
            }
        }

        // --- SPRITES ---
        function drawSprite(ctx, type, x, y) {
            const px = x * TILE; 
            const py = y * TILE;
            
            if (type === 'card') {
                const grad = ctx.createLinearGradient(px+8, py+10, px+32, py+26);
                grad.addColorStop(0, '#2980b9');
                grad.addColorStop(1, '#3498db');
                ctx.fillStyle = grad;
                ctx.shadowBlur = 10;
                ctx.shadowColor = '#3498db';
                ctx.fillRect(px+8, py+10, 24, 16);
                ctx.shadowBlur = 0;
                ctx.fillStyle = '#f1c40f';
                ctx.fillRect(px+10, py+14, 8, 6);
                ctx.fillStyle = '#000';
                ctx.fillRect(px+8, py+12, 24, 2);
                ctx.fillStyle = 'rgba(255,255,255,0.3)';
                ctx.fillRect(px+10, py+11, 20, 1);
            } 
            else if (type === 'kebab') {
                ctx.shadowBlur = 8;
                ctx.shadowColor = 'rgba(0,0,0,0.5)';
                ctx.shadowOffsetY = 3;
                ctx.fillStyle = '#e67e22';
                ctx.beginPath();
                ctx.ellipse(px+20, py+20, 10, 14, 0.2, 0, Math.PI*2);
                ctx.fill();
                ctx.shadowBlur = 0;
                ctx.shadowOffsetY = 0;
                ctx.fillStyle = '#ecf0f1';
                ctx.fillRect(px+16, py+10, 8, 10);
                ctx.fillStyle = '#c0392b';
                ctx.fillRect(px+18, py+20, 4, 4);
                ctx.fillStyle = '#2ecc71';
                ctx.fillRect(px+17, py+17, 6, 2);
            } 
            else if (type === 'cap') {
                ctx.fillStyle = '#000';
                ctx.beginPath();
                ctx.arc(px+20, py+18, 12, 0, Math.PI, true);
                ctx.fill();
                ctx.fillStyle = '#e74c3c';
                ctx.fillRect(px+15, py+18, 20, 5);
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 9px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('PSG', px+20, py+17);
                ctx.textAlign = 'start';
            } 
            else if (type === 'key') {
                ctx.shadowBlur = 15;
                ctx.shadowColor = '#f1c40f';
                ctx.fillStyle = '#f1c40f';
                ctx.fillRect(px+15, py+10, 10, 10);
                ctx.fillRect(px+18, py+20, 4, 15);
                ctx.fillRect(px+22, py+30, 6, 4);
                ctx.fillRect(px+22, py+27, 6, 2);
                ctx.shadowBlur = 0;
            } 
            else if (type === 'foodbag') {
                ctx.fillStyle = '#8e44ad';
                ctx.fillRect(px+10, py+15, 20, 20);
                ctx.fillStyle = '#2ecc71';
                ctx.fillRect(px+12, py+10, 5, 5);
                ctx.fillStyle = '#e74c3c';
                ctx.fillRect(px+20, py+10, 5, 5);
                ctx.strokeStyle = '#6c3483';
                ctx.lineWidth = 2;
                ctx.strokeRect(px+10, py+15, 20, 20);
                ctx.lineWidth = 1;
            } 
            else if (type === 'letter') {
                ctx.fillStyle = '#fff';
                ctx.fillRect(px+8, py+12, 24, 16);
                ctx.strokeStyle = '#e74c3c';
                ctx.lineWidth = 2;
                ctx.strokeRect(px+8, py+12, 24, 16);
                ctx.fillStyle = '#e74c3c';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('‚ù§Ô∏è', px+20, py+24);
                ctx.textAlign = 'start';
                ctx.lineWidth = 1;
            } 
            else if (type === 'pigeon') {
                let bounce = Math.sin(animTimer) * 3;
                ctx.fillStyle = 'rgba(0,0,0,0.4)';
                ctx.beginPath();
                ctx.ellipse(px+20, py+35, 12, 4, 0, 0, Math.PI*2);
                ctx.fill();
                ctx.fillStyle = '#7f8c8d';
                ctx.beginPath();
                ctx.arc(px+20, py+20+bounce, 10, 0, Math.PI*2);
                ctx.fill();
                ctx.fillStyle = '#bdc3c7';
                ctx.beginPath();
                ctx.arc(px+20, py+15+bounce, 6, 0, Math.PI*2);
                ctx.fill();
                ctx.fillStyle = '#f39c12';
                ctx.beginPath();
                ctx.moveTo(px+26, py+15+bounce);
                ctx.lineTo(px+32, py+16+bounce);
                ctx.lineTo(px+26, py+17+bounce);
                ctx.fill();
                ctx.fillStyle = '#FF003C';
                ctx.shadowBlur = 5;
                ctx.shadowColor = '#FF003C';
                ctx.beginPath();
                ctx.arc(px+24, py+13+bounce, 2, 0, Math.PI*2);
                ctx.fill();
                ctx.shadowBlur = 0;
                ctx.fillStyle = '#95a5a6';
                ctx.beginPath();
                ctx.ellipse(px+16, py+22+bounce, 8, 4, -0.5, 0, Math.PI*2);
                ctx.fill();
            } 
            else if (type === 'flower') {
                ctx.fillStyle = '#2ecc71';
                ctx.fillRect(px+19, py+25, 2, 10);
                ctx.fillStyle = (x+y)%2===0 ? '#e74c3c' : '#fff';
                ctx.beginPath();
                ctx.arc(px+20, py+22, 7, 0, Math.PI*2);
                ctx.fill();
                ctx.fillStyle = '#f1c40f';
                ctx.beginPath();
                ctx.arc(px+20, py+22, 3, 0, Math.PI*2);
                ctx.fill();
            } 
            else if (type === 'bench') {
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(px+5, py+10, 30, 10);
                ctx.fillStyle = '#A0522D';
                ctx.fillRect(px+5, py+12, 30, 2);
                ctx.fillRect(px+5, py+16, 30, 2);
            } 
            else if (type === 'metroExit') {
                ctx.fillStyle = '#2c3e50';
                ctx.fillRect(px, py+15, TILE, TILE-15);
                ctx.fillStyle = '#34495e';
                for(let i=0; i<3; i++) {
                    ctx.fillRect(px, py+15 + i*6, TILE, 2);
                }
                ctx.shadowBlur = 20;
                ctx.shadowColor = '#f1c40f';
                ctx.fillStyle = '#f1c40f';
                ctx.beginPath();
                ctx.arc(px+20, py+5, 14, 0, Math.PI*2);
                ctx.fill();
                ctx.shadowBlur = 0;
                ctx.strokeStyle = '#f39c12';
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.arc(px+20, py+5, 14, 0, Math.PI*2);
                ctx.stroke();
                ctx.fillStyle = '#2980b9';
                ctx.font = 'bold 18px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('M', px+20, py+10);
                ctx.textAlign = 'start';
                ctx.lineWidth = 1;
            }
        }

        // --- NOUVEAU : FONCTION DE DESSIN DU JOUEUR (RELATIF) ---
        function drawPlayerSprite(ctx) {
            const bob = Math.sin(animTimer / 2) * 2;
            
            // Ombre
            ctx.fillStyle = 'rgba(0,0,0,0.5)';
            ctx.beginPath();
            ctx.ellipse(20, 35, 12, 5, 0, 0, Math.PI*2);
            ctx.fill();
            
            // Corps
            ctx.fillStyle = '#3498db';
            ctx.fillRect(10, 15+bob, 20, 18);
            
            // T√™te
            ctx.fillStyle = '#f1c40f';
            ctx.beginPath();
            ctx.arc(20, 12+bob, 10, 0, Math.PI*2);
            ctx.fill();
            
            // Yeux
            ctx.fillStyle = '#000';
            ctx.fillRect(16, 10+bob, 3, 3);
            ctx.fillRect(21, 10+bob, 3, 3);
            
            // Sourire
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(20, 14+bob, 5, 0, Math.PI);
            ctx.stroke();
            ctx.lineWidth = 1;
        }

        // --- NOUVEAU : EFFETS DE LUMI√àRE ---
        function drawLightingEffect(ctx) {
            if(currentLevel === 2) { // Pigalle (Nuit + Lampe torche)
                ctx.save();
                ctx.globalCompositeOperation = 'multiply';
                ctx.fillStyle = '#0a0a1a'; // Nuit sombre
                ctx.fillRect(-50, -50, 900, 900);
                
                // Lumi√®re joueur
                ctx.globalCompositeOperation = 'destination-out';
                const grad = ctx.createRadialGradient(
                    renderPlayer.x + 20, renderPlayer.y + 20, 20, 
                    renderPlayer.x + 20, renderPlayer.y + 20, 150
                );
                grad.addColorStop(0, 'rgba(0,0,0,1)');
                grad.addColorStop(1, 'rgba(0,0,0,0)');
                
                ctx.fillStyle = grad;
                ctx.beginPath();
                ctx.arc(renderPlayer.x + 20, renderPlayer.y + 20, 150, 0, Math.PI*2);
                ctx.fill();
                
                // Lumi√®re sortie
                const ex = levels[currentLevel].exit;
                const gradExit = ctx.createRadialGradient(ex.x*TILE+20, ex.y*TILE+20, 10, ex.x*TILE+20, ex.y*TILE+20, 60);
                gradExit.addColorStop(0, 'rgba(0,0,0,1)');
                gradExit.addColorStop(1, 'rgba(0,0,0,0)');
                ctx.fillStyle = gradExit;
                ctx.fillRect(ex.x*TILE-40, ex.y*TILE-40, 120, 120);

                ctx.restore();
            } else { // Vosges (Vignette)
                ctx.save();
                ctx.globalCompositeOperation = 'source-over';
                const grad = ctx.createRadialGradient(400, 400, 300, 400, 400, 600);
                grad.addColorStop(0, 'transparent');
                grad.addColorStop(1, 'rgba(0,50,0,0.3)');
                ctx.fillStyle = grad;
                ctx.fillRect(0,0,800,800);
                ctx.restore();
            }
        }

        // --- GAME LOGIC ---
        function loadLevel(lvlIdx) {
            currentLevel = lvlIdx;
            const data = levels[lvlIdx];
            map = [];
            
            // INIT MAP
            for(let y=0; y<GRID_SIZE; y++) {
                let row = [];
                for(let x=0; x<GRID_SIZE; x++) {
                    let type = 0; // Sol
                    if (x===0 || x===GRID_SIZE-1 || y===0 || y===GRID_SIZE-1) type = 1; // Murs
                    if (lvlIdx === 1) { // VOSGES
                        if (x === 10 && y === 0) type = 2; // Metro
                        else if (x===2 || x===GRID_SIZE-3 || y===2 || y===GRID_SIZE-3) type = 2;
                        else if (x===GRID_SIZE/2 && y===GRID_SIZE/2) type = 2;
                    } 
                    else if (lvlIdx === 2) { // PIGALLE
                        if (x===0 || x===GRID_SIZE-1 || y===0 || y===GRID_SIZE-1) type = 1;
                        else if (x===2 || x===GRID_SIZE-3 || y===2 || y===GRID_SIZE-3 || x===GRID_SIZE/2 || y===GRID_SIZE/2) type = 2;
                        else type = 0;
                    }
                    row.push(type);
                }
                map.push(row);
            }

            items = JSON.parse(JSON.stringify(data.items));
            enemies = JSON.parse(JSON.stringify(data.enemies));
            playerPos = {...data.start};
            score = 0;
            
            // NOUVEAU : INIT VISUELS
            renderPlayer = { x: playerPos.x * TILE, y: playerPos.y * TILE };
            particles = []; 
            
            if(lvlIdx === 1) {
                for(let i=0; i<50; i++) particles.push(new Particle(Math.random()*800, Math.random()*800, 'pollen'));
            } else if (lvlIdx === 2) {
                for(let i=0; i<100; i++) particles.push(new Particle(Math.random()*800, Math.random()*800, 'rain'));
            }
            
            document.getElementById('level-name').innerText = data.name;
            document.getElementById('score').innerText = '0';
            
            if(lvlIdx === 2) showMsg("üåÉ Sam est √† Pigalle !");
        }

        function startGame() {
            document.getElementById('phone-container').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            
            if(player && player.playVideo) { 
                player.unMute(); 
                player.setVolume(50); 
                player.playVideo(); 
            }
            
            gameActive = true;
            loadLevel(1);
            // drawGame est appel√© dans la loop
            gameLoop();
        }

        function gameLoop() {
            if(!gameActive) return;
            updateEnemies();
            drawGame();
            animTimer += 0.15;
            requestAnimationFrame(gameLoop);
        }

        function updateEnemies() {
            if (Math.floor(animTimer) % 10 !== 0) return;
            
            enemies.forEach(e => {
                let nextX = e.x + e.dx;
                
                if (nextX < 0 || nextX >= GRID_SIZE || map[e.y][nextX] === 1) {
                    e.dx *= -1;
                } else {
                    e.x += e.dx;
                }

                // Collision avec joueur
                if (e.x === playerPos.x && e.y === playerPos.y) {
                    screenShake = 20; // NOUVEAU : Shake
                    if(score > 0) {
                        score--;
                        updateScore();
                        showMsg("ü¶Ö Le pigeon a vol√© un indice !");
                        
                        // Respawn item
                        const originalItems = levels[currentLevel].items;
                        const randomItem = originalItems[Math.floor(Math.random() * originalItems.length)];
                        items.push({x: 10, y: 10, type: randomItem.type, name: randomItem.name});
                    } else {
                        showMsg("üí• A√Øe ! Sale pigeon !");
                    }
                    
                    // Push player back
                    let backX = playerPos.x - e.dx * 2;
                    if(backX > 1 && backX < GRID_SIZE-1 && map[playerPos.y][backX] !== 1) {
                        playerPos.x = backX;
                    }
                }
            });
        }

        function updateScore() {
            const scoreEl = document.getElementById('score');
            scoreEl.innerText = score;
            scoreEl.classList.add('score-update');
            setTimeout(() => scoreEl.classList.remove('score-update'), 500);
        }

        let popupTimeout;
        function showPopup(html, duration = 3000) {
            const popup = document.getElementById('main-popup');
            popup.innerHTML = html;
            popup.style.display = 'block';
            clearTimeout(popupTimeout);
            popupTimeout = setTimeout(() => { popup.style.display = 'none'; }, duration);
        }

        function showLoveLetter() {
            const popup = document.getElementById('letter-popup');
            popup.style.display = 'block';
            setTimeout(() => { popup.style.display = 'none'; }, 5000);
        }

        function movePlayer(dx, dy) {
            if(!gameActive) return;
            
            let nx = playerPos.x + dx;
            let ny = playerPos.y + dy;
            
            // Collision murs
            if(map[ny][nx] === 1 && !(currentLevel===1 && nx===10 && ny===0)) return;
            
            playerPos.x = nx;
            playerPos.y = ny;

            // Ramassage items
            let idx = items.findIndex(i => i.x === nx && i.y === ny);
            if(idx !== -1) {
                score++;
                updateScore();
                
                // NOUVEAU : Feedback visuel
                screenShake = 10;
                spawnParticles('score', nx * TILE + 20, ny * TILE + 20, 10);
                
                const item = items[idx];
                
                if(item.type === 'letter') {
                    showLoveLetter();
                } else {
                    let desc = "‚úÖ Indice trouv√© !";
                    if(item.type === 'card') desc = "La carte de Sam ! Il l'a encore paum√©e...";
                    if(item.type === 'kebab') desc = "Le d√Æner de Sam. Il y a un mot d'Alexis dessus.";
                    if(item.type === 'cap') desc = "Il ne sort jamais sans.";
                    if(item.type === 'key') desc = "Pourquoi il a les cl√©s d'Ang√®le ? Bizarre...";
                    if(item.type === 'foodbag') desc = "Il a fait des courses avant de s'endormir.";
                    
                    showPopup(`<h3>${item.name}</h3><p>${desc}</p>`, 3500);
                }
                items.splice(idx, 1);

                if(score === 3) {
                    const exitName = levels[currentLevel].exitName;
                    setTimeout(() => showPopup(`<h3>‚úÖ MISSION ACCOMPLIE ‚úÖ</h3><p>Fonce vers <b>${exitName}</b> !</p>`, 4000), 100);
                }
            }

            // Sortie niveau
            const exit = levels[currentLevel].exit;
            if(nx === exit.x && ny === exit.y) {
                if(score >= 3) {
                    if(currentLevel === 1) {
                        loadLevel(2);
                    } else {
                        gameActive = false;
                        document.getElementById('game-container').style.display='none';
                        document.getElementById('end-screen').style.display='flex';
                    }
                } else {
                    showMsg("‚ùå Il te manque des objets !");
                    playerPos.y += (currentLevel===1 ? 1 : -1);
                }
            }
        }

        function showMsg(txt) {
            const el = document.getElementById('msg-popup');
            el.innerText = txt;
            setTimeout(() => el.innerText = '', 2500);
        }

        // --- NOUVEAU : RENDER (AM√âLIOR√â) ---
        function drawGame() {
            // 1. Interpolation fluide (Lerp)
            let targetX = playerPos.x * TILE;
            let targetY = playerPos.y * TILE;
            renderPlayer.x += (targetX - renderPlayer.x) * LERP_SPEED;
            renderPlayer.y += (targetY - renderPlayer.y) * LERP_SPEED;

            // 2. Gestion du Screen Shake
            let shakeX = 0;
            let shakeY = 0;
            if(screenShake > 0) {
                shakeX = (Math.random() - 0.5) * screenShake;
                shakeY = (Math.random() - 0.5) * screenShake;
                screenShake *= 0.9;
                if(screenShake < 0.5) screenShake = 0;
            }

            ctx.save();
            ctx.translate(shakeX, shakeY); 
            
            ctx.clearRect(0, 0, 800, 800);
            const conf = levels[currentLevel];

            // TERRAIN
            for(let y=0; y<GRID_SIZE; y++) {
                for(let x=0; x<GRID_SIZE; x++) {
                    let t = map[y][x];
                    let px = x*TILE;
                    let py = y*TILE;
                    
                    if(currentLevel === 1) { // VOSGES
                        if (t===1) {
                            ctx.fillStyle = conf.colorWall;
                            ctx.fillRect(px,py,TILE,TILE);
                            ctx.strokeStyle = 'rgba(0,0,0,0.3)';
                            ctx.strokeRect(px,py,TILE,TILE);
                        }
                        else if (t===2) {
                            ctx.fillStyle = conf.colorPath;
                            ctx.fillRect(px,py,TILE,TILE);
                        }
                        else {
                            ctx.fillStyle = conf.colorGround;
                            ctx.fillRect(px,py,TILE,TILE);
                            if((x+y)%9 === 0 && x%3 !== 0 && x>2 && x<17 && y>2 && y<17 && t===0) {
                                drawSprite(ctx, 'flower', x, y);
                            }
                            if((x === 3 || x === 16) && y%4 === 0 && y>2 && y<17) {
                                drawSprite(ctx, 'bench', x, y);
                            }
                        }
                    } 
                    else { // PIGALLE (NEON)
                        if (t===1) {
                            ctx.fillStyle = conf.colorWall;
                            ctx.fillRect(px,py,TILE,TILE);
                            ctx.strokeStyle = '#111';
                            ctx.strokeRect(px,py,TILE,TILE);
                            if((x%3===0 || y%3===0)) {
                                ctx.fillStyle = (x+y)%2===0 ? '#ff00cc' : '#00ccff';
                                ctx.shadowBlur = 20;
                                ctx.shadowColor = ctx.fillStyle;
                                if(Math.sin(animTimer*2) > 0) {
                                    ctx.fillRect(px+5, py+5, TILE-10, TILE-10);
                                }
                                ctx.shadowBlur = 0;
                            }
                        } 
                        else if (t===2) {
                            ctx.fillStyle = conf.colorPath;
                            ctx.fillRect(px,py,TILE,TILE);
                        } 
                        else {
                            ctx.fillStyle = conf.colorGround;
                            ctx.fillRect(px,py,TILE,TILE);
                            ctx.strokeStyle = '#222';
                            ctx.strokeRect(px,py,TILE,TILE);
                        }
                    }
                }
            }

            // ENTITIES
            items.forEach(i => drawSprite(ctx, i.type, i.x, i.y));
            
            // Ennemis
            enemies.forEach(e => {
                ctx.fillStyle = 'rgba(0,0,0,0.3)';
                ctx.beginPath();
                ctx.ellipse(e.x*TILE + 20, e.y*TILE + 35, 12, 4, 0, 0, Math.PI*2);
                ctx.fill();
                drawSprite(ctx, 'pigeon', e.x, e.y);
            });

            // JOUEUR (Liss√©)
            ctx.save();
            ctx.translate(renderPlayer.x, renderPlayer.y);
            drawPlayerSprite(ctx); 
            ctx.restore();

            // EXIT
            const ex = levels[currentLevel].exit;
            if(currentLevel === 1) {
                drawSprite(ctx, 'metroExit', ex.x, ex.y);
            } else {
                ctx.shadowBlur = 20;
                ctx.shadowColor = '#e74c3c';
                ctx.fillStyle = '#e74c3c';
                ctx.fillRect(ex.x*TILE+10, ex.y*TILE+10, 20, 20);
                ctx.shadowBlur = 0;
                ctx.fillStyle='white';
                ctx.font = 'bold 12px Arial';
                ctx.fillText('SAM', ex.x*TILE+8, ex.y*TILE+24);
            }

            // PARTICULES
            particles.forEach((p, index) => {
                p.update();
                p.draw(ctx);
                if(p.life <= 0 && p.type !== 'rain') particles.splice(index, 1);
            });

            // LIGHTING
            drawLightingEffect(ctx);

            ctx.restore();
        }

        // --- CHAT ---
        let msgIndex = 0;
        function playChat() {
            if (msgIndex >= chatMessages.length) {
                document.getElementById('btn-start').style.display = 'block';
                return;
            }
            
            const m = chatMessages[msgIndex];
            const div = document.createElement('div');
            div.className = `msg ${m.s === 'Moi' ? 'right' : 'left'}`;
            div.innerHTML = `<span class="sender">${m.s}</span>${m.t}`;
            
            document.getElementById('chat-body').appendChild(div);
            document.getElementById('chat-body').scrollTop = document.getElementById('chat-body').scrollHeight;
            
            msgIndex++;
            setTimeout(playChat, 1200);
        }

        // --- INPUTS ---
        window.addEventListener('keydown', e => {
            if(e.key.includes('Arrow')) {
                e.preventDefault();
                if(e.key==='ArrowUp') movePlayer(0,-1);
                if(e.key==='ArrowDown') movePlayer(0,1);
                if(e.key==='ArrowLeft') movePlayer(-1,0);
                if(e.key==='ArrowRight') movePlayer(1,0);
            }
        });

        // Touch controls
        let touchStartX = 0, touchStartY = 0;
        document.addEventListener('touchstart', e => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        }, {passive: true});

        document.addEventListener('touchend', e => {
            if(!gameActive) return;
            
            const dx = e.changedTouches[0].clientX - touchStartX;
            const dy = e.changedTouches[0].clientY - touchStartY;
            
            if(Math.abs(dx) > Math.abs(dy)) {
                movePlayer(dx > 0 ? 1 : -1, 0);
            } else {
                movePlayer(0, dy > 0 ? 1 : -1);
            }
        }, {passive: true});

        // --- INIT ---
        window.onload = () => {
            setTimeout(playChat, 4000);
        };
        
        document.getElementById('btn-start').addEventListener('click', startGame);

    </script>
</body>
</html>
